    - name: Установка Docker Engine и Docker Compose
      shell: |
        # Обновление системы и установка зависимостей
        apt-get update
        apt-get install -y ca-certificates curl
        
        # Создание директории для ключей
        install -m 0755 -d /etc/apt/keyrings
        
        # Скачивание GPG ключа Docker
        curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
        chmod a+r /etc/apt/keyrings/docker.asc
        
        # Добавление репозитория через .sources файл (современный метод Ubuntu)
        tee /etc/apt/sources.list.d/docker.sources <<EOF
        Types: deb
        URIs: https://download.docker.com/linux/ubuntu
        Suites: $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}")
        Components: stable
        Signed-By: /etc/apt/keyrings/docker.asc
        EOF
        
        # Обновление кэша пакетов
        apt-get update
        
        # Установка Docker и всех компонентов
        apt-get install -y \
          docker-ce \
          docker-ce-cli \
          containerd.io \
          docker-buildx-plugin \
          docker-compose-plugin
      args:
        creates: /usr/bin/docker