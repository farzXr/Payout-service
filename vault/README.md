# HashiCorp Vault - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É HashiCorp Vault —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Makefile –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **HashiCorp Vault** (–≤–µ—Ä—Å–∏—è 1.10+)
- **Make** (—É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥)
- **OpenSSL** (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤)
- **Bash** (–¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–î–ª—è –ø–æ–ª–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Vault –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–¥–Ω—É –∫–æ–º–∞–Ω–¥—É:

```commandline
make setup
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ —à–∞–≥–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É:

```commandline
make create_ssl    # –°–æ–∑–¥–∞–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
make start_vault   # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ Vault
make init_vault    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Vault
make unseal_vault  # –†–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏–µ Vault
make first_login   # –í—Ö–æ–¥ —Å root —Ç–æ–∫–µ–Ω–æ–º
make enable_auth   # –í–∫–ª—é—á–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
make enable_secrets # –í–∫–ª—é—á–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤
make enable_audit  # –í–∫–ª—é—á–µ–Ω–∏–µ –∞—É–¥–∏—Ç–∞
make write_policies # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞
make write_users   # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```commandline
vault-setup/
‚îú‚îÄ‚îÄ Makefile              # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ configs/              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ server.hcl       # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ listener.hcl     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è listener'–∞
‚îÇ   ‚îú‚îÄ‚îÄ raft.hcl         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Raft —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îÇ   ‚îú‚îÄ‚îÄ telemetry.hcl    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ logs.hcl         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ policies/            # –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
‚îÇ   ‚îú‚îÄ‚îÄ admin.hcl       # –ü–æ–ª–∏—Ç–∏–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ developer.hcl   # –ü–æ–ª–∏—Ç–∏–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
‚îú‚îÄ‚îÄ scripts/            # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ create-ssl.sh   # –°–æ–∑–¥–∞–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ start-vault.sh  # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ Vault
‚îÇ   ‚îú‚îÄ‚îÄ unseal.sh       # –†–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏–µ Vault
‚îÇ   ‚îî‚îÄ‚îÄ write_users.sh  # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îî‚îÄ‚îÄ logs/               # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ª–æ–≥–æ–≤
    ‚îî‚îÄ‚îÄ audit.log       # –§–∞–π–ª –∞—É–¥–∏—Ç–∞
```

üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Make

```commandline

–ö–æ–º–∞–Ω–¥–∞	–û–ø–∏—Å–∞–Ω–∏–µ
make help	        –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –≤—Å–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–º –∫–æ–º–∞–Ω–¥–∞–º
make create_ssl	    –°–æ–∑–¥–∞—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
make start_vault	–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä Vault —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏
make init_vault	    –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Vault (–ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á–∏ —Ä–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏—è –∏ root —Ç–æ–∫–µ–Ω)
make unseal_vault	–†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å Vault —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–ª—é—á–µ–π
make first_login	–í–æ–π—Ç–∏ –≤ Vault —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º root —Ç–æ–∫–µ–Ω–∞
make enable_auth	–í–∫–ª—é—á–∏—Ç—å –º–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ userpass
make enable_secrets	–í–∫–ª—é—á–∏—Ç—å Key-Value secrets engine (–≤–µ—Ä—Å–∏—è 2)
make enable_audit	–í–∫–ª—é—á–∏—Ç—å –∞—É–¥–∏—Ç –≤ —Ñ–∞–π–ª
make write_policies	–ó–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (admin –∏ developer)
make write_users	–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∏–º –ø–æ–ª–∏—Ç–∏–∫–∏
make setup	        –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É Vault (–≤—Å–µ —à–∞–≥–∏ –≤—ã—à–µ)
make	            –ê–ª–∏–∞—Å –¥–ª—è make setup
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
### –°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞: https://127.0.0.1:8200

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è TLS/SSL —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

- Raft —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –≤—ã—Å–æ–∫–æ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
5 –∫–ª—é—á–µ–π —Ä–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏—è, –ø–æ—Ä–æ–≥ 3

- –í–∫–ª—é—á–µ–Ω –∞—É–¥–∏—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ –ø–æ–ª–∏—Ç–∏–∫–∏

### –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- admin - –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –æ–ø–µ—Ä–∞—Ü–∏—è–º

- developer - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏

## üõ†Ô∏è –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

–ï—Å–ª–∏ –≤—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å —à–∞–≥–∏ –≤—Ä—É—á–Ω—É—é:

### –°–æ–∑–¥–∞–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:

```commandline
./scripts/create-ssl.sh
```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:

```commandline
./scripts/start-vault.sh
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:

```commandline
export VAULT_ADDR=https://127.0.0.1:8200
vault operator init
```

### –†–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏–µ:

```commandline
bash
./scripts/unseal.sh
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Å–µ–∫—Ä–µ—Ç–æ–≤:

```commandline
vault login <root_token>
vault auth enable userpass
vault secrets enable -path=secrets -version=2 kv
vault audit enable file file_path=./logs/audit.log
```

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```commandline
vault policy write admin ./policies/admin.hcl
vault policy write developer ./policies/developer.hcl
./scripts/write_users.sh
```

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏
### –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è make init_vault –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã:

- 5 –∫–ª—é—á–µ–π —Ä–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏—è - —Ö—Ä–∞–Ω–∏—Ç–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ

- 1 root —Ç–æ–∫–µ–Ω - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ Vault –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ä–∞—Å–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏–µ:
```commandline
make unseal_vault
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞:
```commandline
export VAULT_ADDR=https://127.0.0.1:8200
vault status
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –í—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞—â–∏—â–µ–Ω—ã SSL/TLS

- Root —Ç–æ–∫–µ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- –ê—É–¥–∏—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤–µ–¥–µ—Ç—Å—è –≤ ./logs/audit.log

- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ —Ä–µ–∞–ª–∏–∑—É—é—Ç –ø—Ä–∏–Ω—Ü–∏–ø –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
–û—à–∏–±–∫–∏ SSL
–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏ SSL, –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:

```commandline
make create_ssl
```
## –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:

```commandline
ps aux | grep vault
```